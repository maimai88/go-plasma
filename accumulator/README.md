# Plasma Prime is Plasma Cash with RSA Accumulators

Author: Sourabh Niyogi (`sourabh@wolk.com`)

This `accumulator` package adapts [David Lazar’s RSA Accumulator implementation](https://github.com/davidlazar/accumulator/blob/58d9dfac50830c9d04014792f9789afcbfef4548/accumulator.go#L109) to develop some basic test cases and performance measurements for proof of inclusion and then proof of exclusion with sequential coinIDs.  It is hoped that compact proofs of non-spend support a much lower client storage requirement in the "stateless" with the compact proofs of exclusion specifically, eliminating the need for "Bloom Filters" completely.  See [Plasma Prime spec?](https://ethresear.ch/t/plasma-prime-spec/4181/2) for my working notes on this.

### Core Test case: Evolving accumulator state over 10 Blocks

This test case goes through 2 blocks that match @vbuterin's review on Plasma Implementers Call 17 and then puts in 8 more blocks with increasing numbers of coins, showing the timing of computing the new accumulator and the witnesses for all coins affected in the block.
```
Sourabhs-iMac:accumulator sourabh$ go test
Computed 10000 basic primes from 2 to 104729 (268.173021ms)

***** Genesis A_0=3
(Acc compute: 1.678µs) |(Witness compute: 46.559µs) |
***** Block B_1: A_1=4782969 (CHECKED)
 Coin c_0 = 2 Witness: [2187]... Verified!
 Coin c_3 = 7 Witness: [9]... Verified!
(Acc compute: 22.239µs) |(Witness compute: 27.695µs) |
***** Block B_2: A_2=12948499662327159827869804507982512855933681938418923950946251515031484288311751430764776653739580222719753761087956834149221677855493093319881877787651251197928151175761355025998801171365774548737280449162679882921625132853665663758779463625513554615650473517064547091673703099500211063697510664235121326182607825854722991822786190325040074920994582291972238394383543829632573502681551087580538503053455571733222804742679900414469777322055397018386457036624760306109153001923600051292062704312543643188356165134847157907856739057989430545164964822849817653538600906701760467429181710655017060138243688914274760305296 W_2=[[24174980594357771827715704064459162844398380235147048684900723681662474892580206353193273957595265722378771006379782201090474455633303126153586381934802736530082319941637568522825634052958687604922415730731760841180816596920659631782946712793328930472544386868091076652126326115614293990004943219634887409540333181920309187108022452911095113798284112951125325815331849 26916567762526151251264787511703378083192691875178597078939245658401142893059912310575694574868157271433287626233202316784205488917308643396621258274873873245264466788989468774041761126416201176777094075519968968951090809 15684240429131529254685698284890751184639406145730291592802676915731672495230992603635422093849215049]]
 Coin c_1 = 3 Witness: [24174980594357771827715704064459162844398380235147048684900723681662474892580206353193273957595265722378771006379782201090474455633303126153586381934802736530082319941637568522825634052958687604922415730731760841180816596920659631782946712793328930472544386868091076652126326115614293990004943219634887409540333181920309187108022452911095113798284112951125325815331849]... Verified!
 Coin c_2 = 5 Witness: [26916567762526151251264787511703378083192691875178597078939245658401142893059912310575694574868157271433287626233202316784205488917308643396621258274873873245264466788989468774041761126416201176777094075519968968951090809]... Verified!
 Coin c_4 = 11 Witness: [15684240429131529254685698284890751184639406145730291592802676915731672495230992603635422093849215049]... Verified!

**** Block B_3 - 8 coins included | (Acc compute: 767.602µs) |(Witness compute: 5.334462ms) |24 Verify ops (1.653278ms) |
**** Block B_4 - 27 coins included | (Acc compute: 2.893863ms) |(Witness compute: 25.868077ms) |81 Verify ops (5.93824ms) |
**** Block B_5 - 33 coins included | (Acc compute: 2.919736ms) |(Witness compute: 38.302014ms) |99 Verify ops (6.656601ms) |
**** Block B_6 - 38 coins included | (Acc compute: 3.166965ms) |(Witness compute: 48.634929ms) |114 Verify ops (7.935524ms) |
**** Block B_7 - 41 coins included | (Acc compute: 4.042185ms) |(Witness compute: 54.339305ms) |123 Verify ops (8.00178ms) |
**** Block B_8 - 103 coins included | (Acc compute: 9.906664ms) |(Witness compute: 314.158881ms) |309 Verify ops (21.987646ms) |
**** Block B_9 - 228 coins included | (Acc compute: 21.017512ms) |(Witness compute: 1.356946565s) |684 Verify ops (44.273233ms) |
**** Block B_10 - 534 coins included | (Acc compute: 49.658788ms) |(Witness compute: 7.550170649s) |1602 Verify ops (109.089128ms) | PASS
ok  	github.com/wolkdb/go-plasma/accumulator	10.492s
```

Major TODOs:
 1. show proof of exclusion over ranges
 2. redo CoinIDToPrime in some range using prime gap observation, estimate blacklist storage costs for 100MM coin case
 3. demonstrate gas costs of verifying RSA proof of inclusion on MainNet
